<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>Title</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <script src="http://localhost:5000/websockets/socket.io.js"></script>
</head>
<body>
<div id="app">
  <h1>{{title}}</h1>
  <form>
    <input v-model="command" type='text'/>
    <button type="submit" v-on:click.prevent="sendCommand">Exec</button>
  </form>
  <ul>
    <li v-for="resp of responses">
      <pre>{{resp}}</pre>
    </li>
  </ul>
</div>
<script>
  var app = new Vue({
    el: '#app',
    data: {
      title: 'Test Socket2',
      command: '',
      responses: ['Ping', 'Ready'],
      socket: null,
    },
    created() {
      this.socket = io('ws://localhost:5000/monitor', {
        path: '/websockets',
        query: {
          "instanceId": "f04e533e-ea08-4e4b-9d2d-844a5267b3f9"
        }
      });
      this.socket.on('monitorStartedToClient', (resp) => {
        this.receiveMessage('OK')
      })
      this.socket.on('monitorEventToClient', (resp) => {
        const { time,database, source, args } = resp;
        this.receiveMessage(`${time} [${database} ${source}] ${args.join(' ')}`)
      })
      this.socket.on('monitorStoppedToClient', () => {
        alert('monitor stopped')
      })
      this.socket.on('exception', (error) => {
        alert(error.message)
      })
    },
    methods: {
      async sendCommand() {
        this.socket.emit('starMonitorToServer', this.command);
      },
      receiveMessage(resp) {
        this.responses.push(resp);
      }
    }
  })
</script>
</body>
</html>
